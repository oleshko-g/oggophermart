openapi: 3.0.3
info:
    title: Goa API
    version: "0.2"
servers:
    - url: http://localhost:80
      description: Default server for gophermart
paths:
    /api/GET /orders/{number}:
        get:
            tags:
                - accrual
            summary: GetOrder accrual
            operationId: accrual#GetOrder
            parameters:
                - name: number
                  in: path
                  required: true
                  schema:
                    type: string
                    description: Unique user order number
                    example: "39"
                    pattern: '[1-9][0-9]*'
                  example: "234"
            responses:
                "200":
                    description: OK response.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/GetOrderOKResponseBody'
                            example:
                                order: "4"
                                status: REGISTERED
                "204":
                    description: No Content response.
                "429":
                    description: 'The request rate limit has been exceeded: The request rate limit has been exceeded'
                    headers:
                        Retry-After:
                            schema:
                                type: integer
                                example: 7302335436944176448
                                format: int64
                                exclusiveMinimum: 0
                            example: 4310227155295963821
                    content:
                        text/plain:
                            schema:
                                $ref: '#/components/schemas/GophermartError2'
                            example:
                                message: No more than N requests per minute allowed
                "500":
                    description: 'Internal service error: Internal Server Error response.'
    /api/user/balance:
        get:
            tags:
                - balance
            summary: GetUserBalance balance
            description: Get user balance
            operationId: balance#GetUserBalance
            responses:
                "200":
                    description: OK response.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/GetUserBalanceResponseBody'
                            example:
                                current: 500.5
                                withdrawn: 42
                "401":
                    description: 'missing_field: Missing or empty Authorization header'
                    headers:
                        goa-attribute-fault:
                            description: Is the error a server-side fault?
                            schema:
                                type: boolean
                                description: Is the error a server-side fault?
                                example: false
                            example: true
                        goa-attribute-id:
                            description: ID is a unique identifier for this particular occurrence of the problem.
                            schema:
                                type: string
                                description: ID is a unique identifier for this particular occurrence of the problem.
                                example: 123abc
                            example: 123abc
                        goa-attribute-message:
                            description: Message is a human-readable explanation specific to this occurrence of the problem.
                            schema:
                                type: string
                                description: Message is a human-readable explanation specific to this occurrence of the problem.
                                example: parameter 'p' must be an integer
                            example: parameter 'p' must be an integer
                        goa-attribute-name:
                            description: Name is the name of this class of errors.
                            schema:
                                type: string
                                description: Name is the name of this class of errors.
                                example: bad_request
                            example: bad_request
                        goa-attribute-temporary:
                            description: Is the error temporary?
                            schema:
                                type: boolean
                                description: Is the error temporary?
                                example: false
                            example: false
                        goa-attribute-timeout:
                            description: Is the error a timeout?
                            schema:
                                type: boolean
                                description: Is the error a timeout?
                                example: false
                            example: false
                "500":
                    description: 'Internal service error: Internal Server Error response.'
            security:
                - jwt_header_Authorization: []
    /api/user/balance/withdraw:
        post:
            tags:
                - balance
            summary: WithdrawUserBalance balance
            operationId: balance#WithdrawUserBalance
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/WithdrawUserBalanceRequestBody'
                        example:
                            order: "2377225624"
                            sum: 751
            responses:
                "200":
                    description: OK response.
                "401":
                    description: 'missing_field: Missing or empty Authorization header'
                    headers:
                        goa-attribute-fault:
                            description: Is the error a server-side fault?
                            schema:
                                type: boolean
                                description: Is the error a server-side fault?
                                example: true
                            example: false
                        goa-attribute-id:
                            description: ID is a unique identifier for this particular occurrence of the problem.
                            schema:
                                type: string
                                description: ID is a unique identifier for this particular occurrence of the problem.
                                example: 123abc
                            example: 123abc
                        goa-attribute-message:
                            description: Message is a human-readable explanation specific to this occurrence of the problem.
                            schema:
                                type: string
                                description: Message is a human-readable explanation specific to this occurrence of the problem.
                                example: parameter 'p' must be an integer
                            example: parameter 'p' must be an integer
                        goa-attribute-name:
                            description: Name is the name of this class of errors.
                            schema:
                                type: string
                                description: Name is the name of this class of errors.
                                example: bad_request
                            example: bad_request
                        goa-attribute-temporary:
                            description: Is the error temporary?
                            schema:
                                type: boolean
                                description: Is the error temporary?
                                example: true
                            example: false
                        goa-attribute-timeout:
                            description: Is the error a timeout?
                            schema:
                                type: boolean
                                description: Is the error a timeout?
                                example: false
                            example: true
                "402":
                    description: 'Insufficient funds: Insufficient funds'
                "422":
                    description: 'Invalid order number: Invalid order number'
                "500":
                    description: 'Internal service error: Internal Server Error response.'
            security:
                - jwt_header_Authorization: []
    /api/user/login:
        post:
            tags:
                - user
            summary: login user
            operationId: user#login
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/LoginPassword'
                        example:
                            login: <login>
                            password: <password>
            responses:
                "200":
                    description: OK response.
                    headers:
                        Authorization:
                            description: A JWT token used to authenticate a request
                            schema:
                                type: string
                                description: A JWT token used to authenticate a request
                                example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWUsImlhdCI6MTUxNjIzOTAyMn0.KMUFsIDTnFmyG3nMiGM6H9FNFUROf3wh7SmqJp-QV30
                            example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWUsImlhdCI6MTUxNjIzOTAyMn0.KMUFsIDTnFmyG3nMiGM6H9FNFUROf3wh7SmqJp-QV30
                "400":
                    description: 'Invalid input parameter: Bad Request response.'
                "401":
                    description: 'User is not authenticated: User is not authenticated'
                "500":
                    description: 'Internal service error: Internal Server Error response.'
    /api/user/orders:
        get:
            tags:
                - balance
            summary: ListUserOrder balance
            description: List user orders
            operationId: balance#ListUserOrder
            responses:
                "200":
                    description: OK response.
                    content:
                        application/json:
                            schema:
                                type: array
                                items:
                                    $ref: '#/components/schemas/Order'
                                example:
                                    - accrual: 500
                                      number: "9278923470"
                                      status: PROCESSED
                                      uploaded_at: "2020-12-10T15:15:45+03:00"
                                    - number: "12345678903"
                                      status: PROCESSING
                                      uploaded_at: "2020-12-10T15:12:01+03:00"
                                    - number: "346436439"
                                      status: INVALID
                                      uploaded_at: "2020-12-09T16:09:53+03:00"
                            example:
                                - accrual: 500
                                  number: "9278923470"
                                  status: PROCESSED
                                  uploaded_at: "2020-12-10T15:15:45+03:00"
                                - number: "12345678903"
                                  status: PROCESSING
                                  uploaded_at: "2020-12-10T15:12:01+03:00"
                                - number: "346436439"
                                  status: INVALID
                                  uploaded_at: "2020-12-09T16:09:53+03:00"
                "204":
                    description: No orders available
                "401":
                    description: 'missing_field: Missing or empty Authorization header'
                    headers:
                        goa-attribute-fault:
                            description: Is the error a server-side fault?
                            schema:
                                type: boolean
                                description: Is the error a server-side fault?
                                example: true
                            example: true
                        goa-attribute-id:
                            description: ID is a unique identifier for this particular occurrence of the problem.
                            schema:
                                type: string
                                description: ID is a unique identifier for this particular occurrence of the problem.
                                example: 123abc
                            example: 123abc
                        goa-attribute-message:
                            description: Message is a human-readable explanation specific to this occurrence of the problem.
                            schema:
                                type: string
                                description: Message is a human-readable explanation specific to this occurrence of the problem.
                                example: parameter 'p' must be an integer
                            example: parameter 'p' must be an integer
                        goa-attribute-name:
                            description: Name is the name of this class of errors.
                            schema:
                                type: string
                                description: Name is the name of this class of errors.
                                example: bad_request
                            example: bad_request
                        goa-attribute-temporary:
                            description: Is the error temporary?
                            schema:
                                type: boolean
                                description: Is the error temporary?
                                example: true
                            example: true
                        goa-attribute-timeout:
                            description: Is the error a timeout?
                            schema:
                                type: boolean
                                description: Is the error a timeout?
                                example: true
                            example: false
                "500":
                    description: 'Internal service error: Internal Server Error response.'
            security:
                - jwt_header_Authorization: []
        post:
            tags:
                - balance
            summary: UploadUserOrder balance
            description: Upload user order
            operationId: balance#UploadUserOrder
            requestBody:
                description: Unique user order number
                required: true
                content:
                    application/json:
                        schema:
                            type: string
                            description: Unique user order number
                            example: "12345678903"
                            pattern: '[1-9][0-9]*'
                        example: "12345678903"
            responses:
                "200":
                    description: The order has been accepted for processing before.
                "202":
                    description: The order has been accepted for processing.
                "400":
                    description: 'Invalid input parameter: Bad Request response.'
                "401":
                    description: 'missing_field: Missing or empty Authorization header'
                    headers:
                        goa-attribute-fault:
                            description: Is the error a server-side fault?
                            schema:
                                type: boolean
                                description: Is the error a server-side fault?
                                example: true
                            example: true
                        goa-attribute-id:
                            description: ID is a unique identifier for this particular occurrence of the problem.
                            schema:
                                type: string
                                description: ID is a unique identifier for this particular occurrence of the problem.
                                example: 123abc
                            example: 123abc
                        goa-attribute-message:
                            description: Message is a human-readable explanation specific to this occurrence of the problem.
                            schema:
                                type: string
                                description: Message is a human-readable explanation specific to this occurrence of the problem.
                                example: parameter 'p' must be an integer
                            example: parameter 'p' must be an integer
                        goa-attribute-name:
                            description: Name is the name of this class of errors.
                            schema:
                                type: string
                                description: Name is the name of this class of errors.
                                example: bad_request
                            example: bad_request
                        goa-attribute-temporary:
                            description: Is the error temporary?
                            schema:
                                type: boolean
                                description: Is the error temporary?
                                example: true
                            example: false
                        goa-attribute-timeout:
                            description: Is the error a timeout?
                            schema:
                                type: boolean
                                description: Is the error a timeout?
                                example: false
                            example: true
                "409":
                    description: 'The order belongs to another user: The order belongs to another user'
                "422":
                    description: 'Invalid order number: Invalid order number'
                "500":
                    description: 'Internal service error: Internal Server Error response.'
            security:
                - jwt_header_Authorization: []
    /api/user/register:
        post:
            tags:
                - user
            summary: register user
            operationId: user#register
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/LoginPassword'
                        example:
                            login: <login>
                            password: <password>
            responses:
                "200":
                    description: OK response.
                    headers:
                        Authorization:
                            description: A JWT token used to authenticate a request
                            schema:
                                type: string
                                description: A JWT token used to authenticate a request
                                example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWUsImlhdCI6MTUxNjIzOTAyMn0.KMUFsIDTnFmyG3nMiGM6H9FNFUROf3wh7SmqJp-QV30
                            example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWUsImlhdCI6MTUxNjIzOTAyMn0.KMUFsIDTnFmyG3nMiGM6H9FNFUROf3wh7SmqJp-QV30
                "400":
                    description: 'Invalid input parameter: Bad Request response.'
                "409":
                    description: 'Login is taken already: Login is taken already'
                "500":
                    description: 'Internal service error: Internal Server Error response.'
components:
    schemas:
        GetOrderOKResponseBody:
            type: object
            properties:
                accrual:
                    type: number
                    example: 0.9953659698380753
                    format: double
                    exclusiveMinimum: 0
                order:
                    type: string
                    example: "282"
                    pattern: '[1-9][0-9]*'
                status:
                    type: string
                    example: PROCESSED
                    enum:
                        - REGISTERED
                        - INVALID
                        - PROCESSING
                        - PROCESSED
            example:
                order: "4"
                status: REGISTERED
            required:
                - order
                - status
        GetOrderResult:
            type: object
            example: {}
        GetUserBalanceResponseBody:
            type: object
            properties:
                current:
                    type: number
                    example: 0.9457019061115151
                    format: double
                    minimum: 0
                withdrawn:
                    type: number
                    example: 0.1877772562583166
                    format: double
                    minimum: 0
            example:
                current: 500.5
                withdrawn: 42
            required:
                - current
                - withdrawn
        GophermartError:
            type: object
            properties:
                message:
                    type: string
                    example: No more than N requests per minute allowed
                retryAfter:
                    type: integer
                    example: 3150985435682770497
                    format: int64
                    exclusiveMinimum: 0
            required:
                - retryAfter
        GophermartError2:
            type: object
            properties:
                message:
                    type: string
                    example: No more than N requests per minute allowed
            example:
                message: No more than N requests per minute allowed
        JWTToken:
            type: object
            properties:
                authToken:
                    type: string
                    description: A JWT token used to authenticate a request
                    example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWUsImlhdCI6MTUxNjIzOTAyMn0.KMUFsIDTnFmyG3nMiGM6H9FNFUROf3wh7SmqJp-QV30
            example:
                authToken: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWUsImlhdCI6MTUxNjIzOTAyMn0.KMUFsIDTnFmyG3nMiGM6H9FNFUROf3wh7SmqJp-QV30
            required:
                - authToken
        LoginPassword:
            type: object
            properties:
                login:
                    type: string
                    example: Repellat temporibus sit consequatur.
                password:
                    type: string
                    example: Assumenda ratione sit asperiores consequuntur earum.
            example:
                login: <login>
                password: <password>
            required:
                - login
                - password
        Order:
            type: object
            properties:
                accrual:
                    type: integer
                    example: 7636844624533436662
                    format: int64
                number:
                    type: string
                    example: "484"
                    pattern: '[1-9][0-9]*'
                status:
                    type: string
                    example: PROCESSED
                    enum:
                        - NEW
                        - PROCESSING
                        - INVALID
                        - PROCESSED
                uploaded_at:
                    type: string
                    example: "2005-03-19T03:13:42Z"
                    format: date-time
            example:
                accrual: 14590931390038943123
                number: "8"
                status: NEW
                uploaded_at: "2007-05-12T04:57:06Z"
            required:
                - number
                - status
                - uploaded_at
        PostOrderResult:
            type: object
        WithdrawUserBalanceRequestBody:
            type: object
            properties:
                order:
                    type: string
                    example: "2"
                    pattern: '[1-9][0-9]*'
                sum:
                    type: number
                    example: 0.827205223024929
                    format: double
                    exclusiveMinimum: 0
            example:
                order: "2377225624"
                sum: 751
            required:
                - order
                - sum
    securitySchemes:
        jwt_header_Authorization:
            type: http
            description: Secures an endpoint by requiring a valid JWT token.
            scheme: bearer
tags:
    - name: balance
    - name: user
    - name: accrual
